<!DOCTYPE html>
<html>
<head>
    <title>Wishlist Test</title>
    <script src="js/jquery.min.js"></script>
    <script src="js/cookie.js"></script>
</head>
<body>
    <h1>Wishlist Button Test</h1>
    <button id="wishlistBtn">Add to Wishlist (Test)</button>
    <div id="output" style="margin-top: 20px; padding: 10px; border: 1px solid #ccc;"></div>

    <script>
    $(function(){
        // Initialize cookie if not exists
        var cookieValue = $.cookie("ArtLineactivity");
        $('#output').append('<p>Cookie exists: ' + (cookieValue ? 'YES' : 'NO') + '</p>');
        
        if (!cookieValue) {
            var array = {
                "wishlist": {
                    "id": []
                },
                "cart": []
            };
            $.cookie("ArtLineactivity", JSON.stringify(array), { path: '/' });
            $('#output').append('<p>Cookie created!</p>');
        } else {
            $('#output').append('<p>Cookie value: ' + cookieValue + '</p>');
        }

        $("body").on('click','#wishlistBtn',function(e){
            e.preventDefault();
            $('#output').append('<p>Button clicked!</p>');
            
            if ( confirm("Are you sure you want to add this item to your wishlist?") ){
                var id = 123; // Test product ID
                
                try {
                    var cookieValue = $.cookie("ArtLineactivity");
                    $('#output').append('<p>Cookie retrieved: ' + cookieValue + '</p>');
                    
                    if (!cookieValue) {
                        alert("Session not initialized. Please refresh the page.");
                        location.reload();
                        return false;
                    }
                    
                    var wishlistArray = JSON.parse(cookieValue);
                    $('#output').append('<p>Parsed cookie successfully</p>');
                    
                    if (!wishlistArray.wishlist) {
                        wishlistArray.wishlist = { id: [] };
                    }
                    if (!wishlistArray.wishlist.id) {
                        wishlistArray.wishlist.id = [];
                    }
                    
                    // Check if product already in wishlist
                    if (wishlistArray.wishlist.id.indexOf(id) !== -1) {
                        alert("Item is already in your wishlist.");
                        return false;
                    }
                    
                    wishlistArray["wishlist"]["id"].push(id);
                    $('#output').append('<p>Added ID to wishlist array</p>');
                    
                    $.cookie("ArtLineactivity", JSON.stringify(wishlistArray), { path: '/' });
                    $('#output').append('<p>Cookie updated. Wishlist count: ' + wishlistArray["wishlist"]["id"].length + '</p>');
                    
                    alert("Item has been added to your wishlist successfully.");
                } catch (error) {
                    console.error("Wishlist error:", error);
                    $('#output').append('<p style="color:red;">Error: ' + error.message + '</p>');
                    alert("Error adding to wishlist. Please try again.");
                }
            }
        });
    });
    </script>
</body>
</html>
